# ============================================================
# EchoDB - PostgreSQL to ClickHouse CDC with PeerDB
# ============================================================
# Copy this file to .env and configure your values

# -----------------------
# Project Configuration
# -----------------------
COMPOSE_PROJECT_NAME=echodb
NETWORK_NAME=echodb-network

# -----------------------
# PostgreSQL (App Database)
# -----------------------
POSTGRES_VERSION=17-alpine
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=echodb
POSTGRES_PASSWORD=password
POSTGRES_DB=echodb

# -----------------------
# Redis
# -----------------------
REDIS_VERSION=7.4-alpine
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=

# -----------------------
# ClickHouse
# -----------------------
CLICKHOUSE_VERSION=25.8
CLICKHOUSE_HOST=clickhouse
CLICKHOUSE_PORT=8123
CLICKHOUSE_NATIVE_PORT=9000
CLICKHOUSE_DATABASE=echodb
CLICKHOUSE_USER=echodb
CLICKHOUSE_PASSWORD=password

# -----------------------
# PeerDB Catalog (PostgreSQL for PeerDB metadata)
# -----------------------
PEERDB_CATALOG_VERSION=16-alpine
PEERDB_CATALOG_HOST=catalog
PEERDB_CATALOG_PORT=5433
PEERDB_CATALOG_USER=postgres
PEERDB_CATALOG_PASSWORD=postgres
PEERDB_CATALOG_DATABASE=postgres

# -----------------------
# PeerDB Configuration
# -----------------------
PEERDB_VERSION=latest-dev
PEERDB_HOST=peerdb
PEERDB_PORT=9900
PEERDB_USER=echodb
PEERDB_PASSWORD=password
PEERDB_FLOW_SERVER_ADDRESS=grpc://flow-api:8112

# PeerDB UI
PEERDB_UI_PORT=3000
PEERDB_NEXTAUTH_SECRET=__changeme__
PEERDB_NEXTAUTH_URL=http://localhost:3000

# -----------------------
# Temporal (Workflow Orchestration)
# -----------------------
TEMPORAL_VERSION=1.28
TEMPORAL_HOST=temporal
TEMPORAL_PORT=7233
TEMPORAL_UI_PORT=8085
TEMPORAL_NAMESPACE=default

# Temporal Admin Tools
TEMPORAL_ADMIN_TOOLS_VERSION=1.28

# -----------------------
# MinIO (S3 Storage for PeerDB CDC)
# -----------------------
MINIO_VERSION=RELEASE.2024-07-16T23-46-41Z
MINIO_PORT=9001
MINIO_CONSOLE_PORT=9002
MINIO_ROOT_USER=_peerdb_minioadmin
MINIO_ROOT_PASSWORD=_peerdb_minioadmin
PEERDB_S3_BUCKET=peerdbbucket
PEERDB_S3_REGION=us-east-1
PEERDB_S3_ENDPOINT=http://host.docker.internal:9001

# -----------------------
# Auto-Mirror Worker Configuration
# -----------------------
# Source peer name (created during setup)
SOURCE_PEER_NAME=postgres_main
# Target peer name (created during setup)
TARGET_PEER_NAME=clickhouse_analytics
# Schema(s) to watch for new tables (comma-separated)
# Examples: "public" or "public,analytics,logs"
SYNC_SCHEMA=public
# Tables to exclude from auto-mirror (comma-separated)
EXCLUDED_TABLES=spatial_ref_sys,geometry_columns,geography_columns,raster_columns,raster_overviews

# Retry Configuration
MAX_RETRIES=5
RETRY_DELAY=5
RETRY_BACKOFF=2.0

# Reconnect Configuration
RECONNECT_DELAY=10
MAX_RECONNECT_ATTEMPTS=10

# Logging Configuration
LOG_LEVEL=INFO
LOG_FILE=/var/log/echodb/auto-mirror.log

# Health Check Configuration
HEALTH_CHECK_PORT=8080
HEALTH_CHECK_HOST=0.0.0.0

# Consistency Checker Configuration
CONSISTENCY_CHECK_INTERVAL=900  # 15 minutes
CONSISTENCY_SAMPLE_SIZE=100
CONSISTENCY_MAX_LAG=300  # 5 minutes
CONSISTENCY_CHECKER_PORT=8090
CONSISTENCY_CHECKER_HOST=0.0.0.0

# Circuit Breaker Configuration
PEERDB_FAILURE_THRESHOLD=5
PEERDB_SUCCESS_THRESHOLD=2
PEERDB_TIMEOUT=60
POSTGRES_FAILURE_THRESHOLD=3
POSTGRES_SUCCESS_THRESHOLD=2
POSTGRES_TIMEOUT=30

# -----------------------
# Leader Election Configuration (HA)
# -----------------------
# Unique identifier for each worker instance (auto-generated if not set)
WORKER_ID=worker-1
# Leadership lease time-to-live in seconds
LEADER_ELECTION_TTL=30
# Interval between leadership acquisition attempts when not leader
LEADER_ELECTION_INTERVAL=10

# -----------------------
# Docker Volume Names
# -----------------------
VOLUME_POSTGRES=echodb_postgres_data
VOLUME_REDIS=echodb_redis_data
VOLUME_CLICKHOUSE=echodb_clickhouse_data
VOLUME_MINIO=echodb_minio_data
VOLUME_CATALOG=echodb_catalog_data
